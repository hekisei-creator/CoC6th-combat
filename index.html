<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇØ„Éà„Ç•„É´„ÉïÁ•ûË©±TRPG ÈäÉÁÅ´Âô®Êà¶Èóò„Çµ„Éù„Éº„Çø„Éº v6.7</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital@1&family=Noto+Serif+JP:wght@400;700&family=Playfair+Display:wght@700&family=Share+Tech+Mono&family=Special+Elite&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ======================================== */
        /* ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ („É¨„Ç§„Ç¢„Ç¶„Éà)                */
        /* ======================================== */
        :root {
            --base-bg: #f0f0f0;
            --text-color: #333;
            --container-bg: #fff;
            --header-bg: #f8f8f8;
            --list-bg: #e9e9e9;
            --item-bg: #fff;
            --border-color: #ddd;
            --accent-color: #3498db;
            --font-main: 'Helvetica', 'Arial', sans-serif;
        }

        body {
            background-color: var(--base-bg);
            color: var(--text-color);
            font-family: var(--font-main);
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s, color 0.5s;
        }

        .container {
            max-width: 800px;
            margin-left: 0;
            margin-right: auto;
            background-color: var(--container-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            transition: background-color 0.5s, border-color 0.5s;
        }

        header {
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 20px;
            background-color: var(--header-bg);
        }

        h1 { margin-top: 0; transition: color 0.5s; }
        h2 { text-align: left; margin: 0 0 15px 0; transition: color 0.5s; }

        .controls-wrapper { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .top-controls { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .add-character-form { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; }
        .char-type-selector label { margin-right: 10px; }

        input[type="text"], input[type="number"], button, select {
            padding: 8px;
            font-family: inherit;
            font-size: 1em;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        #character-initiative { width: 60px; text-align: center; }
        
        button { cursor: pointer; }
        .combat-rounds { display: flex; flex-direction: column; gap: 20px; }
        .dex-cycle { background-color: var(--container-bg); border: 1px solid var(--border-color); flex: 1; padding: 15px; position: relative; }
        .character-list { list-style: none; padding: 5px; margin: 0; min-height: 150px; background-color: var(--list-bg); border-radius: 4px; }
        
        .character-list:empty::before {
            content: attr(data-empty-text, "--- NO DATA ---"); /* ‚òÖ„Éá„Éº„ÇøÂ±ûÊÄß„Åã„Çâ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂèñÂæó */
            display: block;
            text-align: center;
            color: var(--text-color);
            opacity: 0.5;
            padding: 50px 0;
            font-size: 1.2em;
            font-style: italic;
            background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px));
            background-size: 100% 100%;
        }

        .character-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--item-bg);
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            margin: 8px;
            border-radius: 4px;
            cursor: grab;
            font-size: 1.2em;
            font-weight: bold;
            user-select: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .character-info { display: flex; align-items: center; gap: 15px; }
        .char-initiative {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent-color);
            min-width: 3ch;
            text-align: center;
        }
        .char-icon { width: 1.2em; height: 1.2em; flex-shrink: 0; display: inline-flex; justify-content: center; align-items: center; box-sizing: border-box; }

        .delete-btn {
            background: transparent; border: none; font-size: 1.5em; color: #aaa;
            cursor: pointer; padding: 0 5px; opacity: 0.5; transition: opacity 0.3s, color 0.3s;
        }
        .character-item:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { color: #f00; }

        #reset-btn { background-color: #e74c3c; color: white; border-color: #c0392b; }
        #capture-btn { background-color: #28a745; color: white; border-color: #218838; }
        
        /* ================================================================== */
        /* „ÉÜ„Éº„Éû„Åî„Å®„ÅÆ„Çπ„Çø„Ç§„É´                                               */
        /* ================================================================== */

        /* --- „ÉÜ„Éº„Éû: „Éá„Éï„Ç©„É´„Éà --- */
        body.theme-default {
            --base-bg: #2c3e50; --text-color: #ecf0f1; --container-bg: #34495e; --header-bg: #34495e;
            --list-bg: #2c3e50; --item-bg: #4a637e; --border-color: #2c3e50; --accent-color: #3498db;
            --font-main: 'Meiryo', '„É°„Ç§„É™„Ç™', sans-serif;
        }
        .theme-default h1, .theme-default h2 { color: #95a5a6; }
        .theme-default .char-icon::before { font-size: 1em; }
        .theme-default .char-icon.investigator::before, .theme-default .char-icon.npc::before { content: 'üë§'; }
        .theme-default .char-icon.enemy::before { content: 'üíÄ'; }
        .theme-default .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #95a5a6 50%, transparent calc(50% + 1px)); }
        
        /* --- „ÉÜ„Éº„Éû: „Çµ„Ç§„Éê„Éº --- */
        body.theme-cyber {
            --base-bg: #0d0f18; --text-color: #e0e0e0; --container-bg: rgba(20, 25, 40, 0.7); --header-bg: transparent;
            --list-bg: rgba(0, 0, 0, 0.2); --item-bg: transparent; --border-color: #00ffff; --accent-color: #00ffff;
            --font-main: 'Share Tech Mono', monospace;
        }
        .theme-cyber .container { box-shadow: 0 0 5px var(--border-color), 0 0 10px var(--border-color); backdrop-filter: blur(10px); }
        .theme-cyber h1 { color: var(--accent-color); text-shadow: 0 0 3px var(--accent-color); }
        .theme-cyber .char-initiative { text-shadow: 0 0 3px var(--accent-color); }
        .theme-cyber .char-icon { background-color: var(--dynamic-color); width: 16px; height: 16px; }
        .theme-cyber .char-icon.investigator { transform: rotate(45deg); }
        .theme-cyber .char-icon.npc { border-radius: 50%; }
        .theme-cyber .delete-btn:hover { color: var(--accent-color); text-shadow: 0 0 5px var(--accent-color); }
        .theme-cyber #capture-btn { background-color: #00ffff; color: #0d0f18; border-color: #00ffff; box-shadow: 0 0 5px #00ffff; }
        .theme-cyber #reset-btn { background-color: #ff00ff; color: #0d0f18; border-color: #ff00ff; box-shadow: 0 0 5px #ff00ff; }
        .theme-cyber .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }

        /* --- „ÉÜ„Éº„Éû: „ÇØ„É©„Ç∑„ÉÉ„ÇØ --- */
        body.theme-classic {
            --base-bg: #e8e0d0; --text-color: #4a3f35; --container-bg: #fdfaf2; --header-bg: #f8f1e3;
            --list-bg: #e8e0d0; --item-bg: #fdfaf2; --border-color: #c9bba8; --accent-color: #a67b5b;
            --font-main: 'Playfair Display', serif;
        }
        .theme-classic .container { box-shadow: 5px 5px 15px rgba(0,0,0,0.2); }
        .theme-classic h1 { font-weight: 700; color: var(--text-color); }
        .theme-classic .character-item { border-radius: 0; }
        .theme-classic .char-icon { background-color: var(--dynamic-color); width: 14px; height: 14px; border: 1px solid var(--text-color); }
        .theme-classic .char-icon.investigator { border-radius: 50%; }
        .theme-classic .char-icon.npc { border-radius: 50%; width: 10px; height: 10px; }
        .theme-classic #reset-btn { background-color: #8b4513; border-color: #653412; }
        .theme-classic .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }

        /* --- „ÉÜ„Éº„Éû: ÂíåÈ¢® --- */
        body.theme-japanese {
            --base-bg: #f3f3f3; --text-color: #333333; --container-bg: #ffffff; --header-bg: #fff;
            --list-bg: #e9e5e0; --item-bg: #fff; --border-color: #dcdcdc; --accent-color: #c0392b;
            --font-main: 'Noto Serif JP', serif;
        }
        .theme-japanese .container { border: 2px solid #333; }
        .theme-japanese h1 { color: var(--accent-color); font-weight: 700; }
        .theme-japanese .character-item { border-right: 5px solid var(--dynamic-color); }
        .theme-japanese .char-icon::before { font-size: 1em; }
        .theme-japanese .char-icon.investigator::before { content: 'Êé¢'; }
        .theme-japanese .char-icon.npc::before { content: 'ÔºÆ'; }
        .theme-japanese .char-icon.enemy::before { content: 'Êïµ'; }
        .theme-japanese .delete-btn:hover { color: var(--accent-color); }
        .theme-japanese #reset-btn { background-color: #8B0000; border-color: #5a0000; }
        .theme-japanese .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }
        
        /* --- „ÉÜ„Éº„Éû: „Ç¥„Ç∑„ÉÉ„ÇØ --- */
        body.theme-gothic {
            --base-bg: #1a1a1a; --text-color: #d8d8d8; --container-bg: #2a2a2a; --header-bg: #2a2a2a;
            --list-bg: #1f1f1f; --item-bg: #3a3a3a; --border-color: #444; --accent-color: #9a0000;
            --font-main: 'Crimson Text', serif;
        }
        .theme-gothic .container, .theme-gothic .dex-cycle { border-color: var(--accent-color); box-shadow: 0 0 8px rgba(154, 0, 0, 0.5); }
        .theme-gothic h1 { font-style: italic; color: var(--accent-color); text-shadow: 0 0 5px #ff0000; }
        .theme-gothic .char-icon { width: 16px; height: 16px; position: relative; }
        .theme-gothic .char-icon::before, .theme-gothic .char-icon::after { content: ''; position: absolute; background-color: var(--dynamic-color); }
        .theme-gothic .char-icon.investigator::before, .theme-gothic .char-icon.npc::before { width: 100%; height: 2px; top: 50%; transform: translateY(-50%); }
        .theme-gothic .char-icon.investigator::after, .theme-gothic .char-icon.npc::after { width: 2px; height: 100%; left: 50%; transform: translateX(-50%); }
        .theme-gothic .char-icon.enemy::before { width: 100%; height: 2px; top: 50%; transform: translateY(-50%) rotate(45deg); }
        .theme-gothic .char-icon.enemy::after { width: 100%; height: 2px; top: 50%; transform: translateY(-50%) rotate(-45deg); }
        .theme-gothic .delete-btn:hover { color: var(--accent-color); }
        .theme-gothic #reset-btn { background-color: var(--accent-color); border-color: #660000; }
        .theme-gothic .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }

        /* --- „ÉÜ„Éº„Éû: ÁôªÂ±±ÔºàÁãÇÊ∞óÂ±±ËÑàÔºâ --- */
        body.theme-mountain {
            --base-bg: #dde4ed; --text-color: #2c3e50; --container-bg: rgba(240, 245, 255, 0.8); --header-bg: transparent;
            --list-bg: rgba(200, 210, 225, 0.5); --item-bg: rgba(255, 255, 255, 0.7); --border-color: #a0b0c0; --accent-color: #c0392b;
            --font-main: 'Special Elite', monospace;
            background-image: linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%), linear-gradient(-45deg, rgba(255,255,255,0.05) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.05) 75%), linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.05) 75%);
            background-size: 20px 20px;
            background-color: #34495e;
        }
        .theme-mountain .container { border-style: double; border-width: 3px; backdrop-filter: blur(5px); }
        .theme-mountain h1 { color: #2c3e50; letter-spacing: 2px; }
        .theme-mountain .character-item { border-radius: 2px; border-left: 4px solid var(--dynamic-color); }
        .theme-mountain .char-initiative { color: var(--accent-color); }
        .theme-mountain .char-icon { position: relative; }
        .theme-mountain .char-icon::before, .theme-mountain .char-icon::after { content: ''; position: absolute; background-color: var(--dynamic-color); }
        .theme-mountain .char-icon.investigator::before { width: 3px; height: 100%; left: 50%; transform: translateX(-50%); border-radius: 2px; }
        .theme-mountain .char-icon.investigator::after { width: 60%; height: 3px; top: 15%; left: 15%; transform-origin: left; transform: rotate(-15deg); border-radius: 2px; }
        .theme-mountain .char-icon.npc { border: 3px solid var(--dynamic-color); border-right-color: transparent; border-radius: 10px 50% 50% 10px; transform: rotate(-45deg); background-color: transparent !important; }
        .theme-mountain .char-icon.npc::before, .theme-mountain .char-icon.npc::after { display: none; }
        .theme-mountain .char-icon.enemy { background-color: transparent; border-style: solid; border-width: 0 10px 17.3px 10px; border-color: transparent transparent var(--dynamic-color) transparent; width: 0; height: 0; }
        .theme-mountain #reset-btn { background-color: var(--accent-color); border-color: #992d22; }
        .theme-mountain #capture-btn { background-color: #f39c12; color: white; border-color: #e67e22; }
        .theme-mountain .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #a0b0c0 50%, transparent calc(50% + 1px)); }

        /* --- „ÉÜ„Éº„Éû: „É¢„Éé„ÇØ„É≠ --- */
        body.theme-mono {
            --base-bg: #ffffff; --text-color: #000000; --container-bg: #ffffff; --header-bg: #ffffff;
            --list-bg: #f5f5f5; --item-bg: #ffffff; --border-color: #000000; --accent-color: #000000;
            --font-main: 'Helvetica', 'Arial', sans-serif;
        }
        .theme-mono .container { border: 2px solid #000; box-shadow: none; border-radius: 0; }
        .theme-mono .dex-cycle { border: 2px solid #000; }
        .theme-mono h1 { font-weight: bold; }
        .theme-mono button, .theme-mono select, .theme-mono input[type="text"], .theme-mono input[type="color"] { border-radius: 0; border: 1px solid #000; }
        .theme-mono button { background-color: #eee; }
        .theme-mono button:hover { background-color: #ddd; }
        .theme-mono #reset-btn, .theme-mono #capture-btn { background-color: #000; color: #fff; }
        .theme-mono .character-item { border-radius: 0; }
        .theme-mono .char-icon.investigator { border: 3px solid var(--dynamic-color); border-radius: 50%; }
        .theme-mono .char-icon.npc { background-color: var(--dynamic-color); border-radius: 50%; }
        .theme-mono .char-icon.enemy { background-color: var(--dynamic-color); }
        .theme-mono .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #ccc 50%, transparent calc(50% + 1px)); }

    </style>
</head>
<body class="theme-default">
    <div class="container">
        <header>
            <h1 id="main-title">COMBAT INITIATIVE</h1>
            <div class="controls-wrapper">
                <div class="top-controls">
                    <div class="theme-switcher-wrapper">
                        <label for="theme-switcher" id="theme-label">„Çπ„Ç≠„É≥: </label>
                        <select id="theme-switcher">
                            <option value="theme-default">„Éá„Éï„Ç©„É´„Éà</option>
                            <option value="theme-cyber">„Çµ„Ç§„Éê„Éº</option>
                            <option value="theme-classic">„ÇØ„É©„Ç∑„ÉÉ„ÇØ</option>
                            <option value="theme-japanese">ÂíåÈ¢®</option>
                            <option value="theme-gothic">„Ç¥„Ç∑„ÉÉ„ÇØ</option>
                            <option value="theme-mountain">ÁôªÂ±±ÔºàÁãÇÊ∞óÂ±±ËÑàÔºâ</option>
                            <option value="theme-mono">„É¢„Éé„ÇØ„É≠</option>
                        </select>
                    </div>
                    <button id="reset-btn">ÂÖ®ÂâäÈô§</button>
                    <button id="capture-btn">ÁîªÂÉèÂá∫Âäõ</button>
                </div>
                <div class="add-character-form">
                    <div class="char-type-selector">
                        <input type="radio" id="type-investigator" name="char-type" value="investigator" checked>
                        <label for="type-investigator" id="label-investigator">Êé¢Á¥¢ËÄÖ</label>
                        <input type="radio" id="type-npc" name="char-type" value="npc">
                        <label for="type-npc" id="label-npc">NPC</label>
                        <input type="radio" id="type-enemy" name="char-type" value="enemy">
                        <label for="type-enemy" id="label-enemy">„Ç®„Éç„Éü„Éº</label>
                    </div>
                    <input type="text" id="character-name" placeholder="„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç">
                    <input type="text" id="character-initiative" placeholder="INIT">
                    <input type="color" id="character-color" value="#000000">
                    <button id="add-character-btn">ËøΩÂä†</button>
                </div>
            </div>
        </header>

        <main class="combat-rounds" id="capture-area">
            <div class="dex-cycle" id="dex-cycle-1">
                <h2 id="dex-cycle-1-title">Á¨¨1DEX„Çµ„Ç§„ÇØ„É´ (ÈäÉÁÅ´Âô®ÂÖàÊîª)</h2>
                <ul class="character-list" id="list-1"></ul>
            </div>
            <div class="dex-cycle" id="dex-cycle-2">
                <h2 id="dex-cycle-2-title">Á¨¨2DEX„Çµ„Ç§„ÇØ„É´ (ÈÄöÂ∏∏Ë°åÂãï)</h2>
                <ul class="character-list" id="list-2"></ul>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- UI„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂÆöÁæ© ---
            const uiText = {
                default: {
                    mainTitle: "COMBAT INITIATIVE",
                    themeLabel: "„Çπ„Ç≠„É≥: ",
                    resetBtn: "ÂÖ®ÂâäÈô§",
                    captureBtn: "ÁîªÂÉèÂá∫Âäõ",
                    labelInvestigator: "Êé¢Á¥¢ËÄÖ",
                    labelNpc: "NPC",
                    labelEnemy: "„Ç®„Éç„Éü„Éº",
                    addBtn: "ËøΩÂä†",
                    namePlaceholder: "„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç",
                    initPlaceholder: "INIT",
                    dex1Title: "Á¨¨1DEX„Çµ„Ç§„ÇØ„É´ (ÈäÉÁÅ´Âô®ÂÖàÊîª)",
                    dex2Title: "Á¨¨2DEX„Çµ„Ç§„ÇØ„É´ (ÈÄöÂ∏∏Ë°åÂãï)",
                    emptyData: "--- NO DATA ---"
                },
                japanese: {
                    mainTitle: "Êà¶ÈóòÂ∫èÂàó",
                    themeLabel: "ÊÑèÂå†: ",
                    resetBtn: "ÂÖ®Ê∂àÂéª",
                    captureBtn: "ÁµµÂõ≥Âá∫Âäõ",
                    labelInvestigator: "Êé¢Á¥¢ËÄÖ",
                    labelNpc: "NPC",
                    labelEnemy: "ÊïµÂØæËÄÖ",
                    addBtn: "ËøΩÂä†",
                    namePlaceholder: "Âêç",
                    initPlaceholder: "Ë°åÂãïÂÄ§",
                    dex1Title: "Â£±‰πãÂ∑°ÔºàÈäÉÁÅ´Âô®ÂÖàÊîªÔºâ",
                    dex2Title: "Âºê‰πãÂ∑°ÔºàÈÄöÂ∏∏Ë°åÂãïÔºâ",
                    emptyData: "Ë©≤ÂΩìËÄÖ„Å™„Åó"
                }
            };
            
            // --- Ë¶ÅÁ¥†ÂèñÂæó ---
            const nameInput = document.getElementById('character-name');
            const initiativeInput = document.getElementById('character-initiative');
            const colorInput = document.getElementById('character-color');
            const addButton = document.getElementById('add-character-btn');
            const lists = document.querySelectorAll('.character-list');
            const themeSwitcher = document.getElementById('theme-switcher');
            const resetButton = document.getElementById('reset-btn');
            const captureButton = document.getElementById('capture-btn');
            const captureArea = document.getElementById('capture-area');

            let draggedItem = null;

            // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö ---
            addButton.addEventListener('click', addCharacter);
            nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCharacter(); });
            initiativeInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCharacter(); });
            
            themeSwitcher.addEventListener('change', (e) => {
                const theme = e.target.value;
                document.body.className = theme;
                updateUiText(theme);
                document.querySelectorAll('.character-item').forEach(updateInitiativeDisplay);
            });
            
            resetButton.addEventListener('click', resetAll);
            captureButton.addEventListener('click', captureAndDownload);

            lists.forEach(list => {
                list.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-btn')) {
                        e.target.closest('.character-item').remove();
                    }
                });
            });
            
            // --- Èñ¢Êï∞ÂÆöÁæ© ---
            // ‚òÖ UI„ÉÜ„Ç≠„Çπ„ÉàÊõ¥Êñ∞Èñ¢Êï∞
            function updateUiText(theme) {
                const isJapanese = theme === 'theme-japanese';
                const textSet = isJapanese ? uiText.japanese : uiText.default;

                document.getElementById('main-title').textContent = textSet.mainTitle;
                document.getElementById('theme-label').textContent = textSet.themeLabel;
                resetButton.textContent = textSet.resetBtn;
                captureButton.textContent = textSet.captureBtn;
                document.getElementById('label-investigator').textContent = textSet.labelInvestigator;
                document.getElementById('label-npc').textContent = textSet.labelNpc;
                document.getElementById('label-enemy').textContent = textSet.labelEnemy;
                addButton.textContent = textSet.addBtn;
                nameInput.placeholder = textSet.namePlaceholder;
                initiativeInput.placeholder = textSet.initPlaceholder;
                document.getElementById('dex-cycle-1-title').textContent = textSet.dex1Title;
                document.getElementById('dex-cycle-2-title').textContent = textSet.dex2Title;
                lists.forEach(list => list.dataset.emptyText = textSet.emptyData);
            }

            function addCharacter() {
                const name = nameInput.value.trim();
                let initiative = initiativeInput.value.trim();
                const color = colorInput.value;
                const charType = document.querySelector('input[name="char-type"]:checked').value;

                if (name === '') { alert('„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }
                
                initiative = initiative.replace(/[Ôºê-Ôºô]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));

                const li = document.createElement('li');
                li.className = 'character-item';
                li.draggable = true;
                li.dataset.initiative = initiative;
                
                li.innerHTML = `
                    <div class="character-info">
                        <span class="char-initiative"></span>
                        <span class="char-icon ${charType}"></span>
                        <span class="char-name">${name}</span>
                    </div>
                    <button class="delete-btn">√ó</button>
                `;
                
                li.style.setProperty('--dynamic-color', color);
                li.querySelector('.char-name').style.color = color;
                
                updateInitiativeDisplay(li);

                addDragEvents(li);
                document.getElementById('list-2').appendChild(li);

                nameInput.value = '';
                initiativeInput.value = '';
                nameInput.focus();
            }
            
            function updateInitiativeDisplay(listItem) {
                const initiativeValue = listItem.dataset.initiative;
                const displaySpan = listItem.querySelector('.char-initiative');

                if (document.body.classList.contains('theme-japanese')) {
                    displaySpan.textContent = toKanjiNumber(initiativeValue);
                } else {
                    displaySpan.textContent = initiativeValue || '-';
                }
            }
            
            function toKanjiNumber(numStr) {
                if (!numStr || isNaN(parseInt(numStr, 10))) {
                    return numStr || '-';
                }

                const num = parseInt(numStr, 10);
                if (num === 0) return 'Èõ∂';

                const kanjiDigits = ['', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', '‰∏É', 'ÂÖ´', '‰πù'];
                let result = '';

                if (num >= 10) {
                    const tens = Math.floor(num / 10);
                    result += (tens > 1 ? kanjiDigits[tens] : '') + 'ÂçÅ';
                }
                const ones = num % 10;
                if (ones > 0) {
                    result += kanjiDigits[ones];
                }
                return result;
            }

            function resetAll() {
                if (confirm('Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                    lists.forEach(list => list.innerHTML = '');
                }
            }
            
            function captureAndDownload() {
                const computedStyle = getComputedStyle(document.body);
                let bgColor = computedStyle.backgroundColor;
                if (bgColor === 'rgba(0, 0, 0, 0)') {
                    bgColor = '#ffffff';
                }

                html2canvas(captureArea, {
                    backgroundColor: bgColor,
                    scale: 2,
                    windowWidth: captureArea.scrollWidth,
                    windowHeight: captureArea.scrollHeight
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'combat_initiative.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }

            function addDragEvents(item) {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    setTimeout(() => item.classList.add('dragging'), 0);
                });
                item.addEventListener('dragend', () => {
                    if(draggedItem) draggedItem.classList.remove('dragging');
                    draggedItem = null;
                });
            }

            lists.forEach(list => {
                list.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(list, e.clientY);
                    if (draggedItem) {
                        if (afterElement == null) list.appendChild(draggedItem);
                        else list.insertBefore(draggedItem, afterElement);
                    }
                });
            });

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.character-item:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            
            // ‚òÖ ÂàùÊúüÂåñ
            updateUiText(themeSwitcher.value);
        });
    </script>
</body>
</html>