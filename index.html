<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇØ„Éà„Ç•„É´„ÉïÁ•ûË©±TRPG ÈäÉÁÅ´Âô®Êà¶Èóò„Çµ„Éù„Éº„Çø„Éº v7.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital@1&family=Noto+Serif+JP:wght@400;700&family=Playfair+Display:wght@700&family=Share+Tech+Mono&family=Special+Elite&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ======================================== */
        /* ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ („É¨„Ç§„Ç¢„Ç¶„Éà)                */
        /* ======================================== */
        :root {
            --base-bg: #f0f0f0;
            --text-color: #333;
            --container-bg: #fff;
            --header-bg: #f8f8f8;
            --list-bg: #e9e9e9;
            --item-bg: #fff;
            --border-color: #ddd;
            --accent-color: #3498db;
            --font-main: 'Helvetica', 'Arial', sans-serif;
        }

        body {
            background-color: var(--base-bg);
            color: var(--text-color);
            font-family: var(--font-main);
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s, color 0.5s;
        }

        .container {
            max-width: 800px;
            margin-left: 0;
            margin-right: auto;
            background-color: var(--container-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            transition: background-color 0.5s, border-color 0.5s;
        }

        header {
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 20px;
            background-color: var(--header-bg);
        }

        h1 { margin-top: 0; transition: color 0.5s; }
        h2 { text-align: left; margin: 0 0 15px 0; transition: color 0.5s; }

        .controls-wrapper { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .top-controls { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .add-character-form { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; }
        .char-type-selector label { margin-right: 10px; }

        input[type="text"], input[type="number"], button, select {
            padding: 8px;
            font-family: inherit;
            font-size: 1em;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        #character-initiative { width: 60px; text-align: center; }
        
        button { cursor: pointer; }
        .combat-rounds { display: flex; flex-direction: column; gap: 20px; padding-left: 30px; }
        .dex-cycle { background-color: var(--container-bg); border: 1px solid var(--border-color); flex: 1; padding: 15px; position: relative; }
        .character-list { list-style: none; padding: 5px; margin: 0; min-height: 150px; background-color: var(--list-bg); border-radius: 4px; }
        
        .character-list:empty::before {
            content: attr(data-empty-text, "--- NO DATA ---");
            display: block;
            text-align: center;
            color: var(--text-color);
            opacity: 0.5;
            padding: 50px 0;
            font-size: 1.2em;
            font-style: italic;
            background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px));
            background-size: 100% 100%;
        }

        .character-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--item-bg);
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            margin: 8px;
            border-radius: 4px;
            cursor: grab;
            font-size: 1.2em;
            font-weight: bold;
            user-select: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .character-info { display: flex; align-items: center; gap: 15px; }
        .char-initiative { font-size: 1.1em; font-weight: bold; color: var(--accent-color); min-width: 3ch; text-align: center; }
        .char-icon { width: 1.2em; height: 1.2em; flex-shrink: 0; display: inline-flex; justify-content: center; align-items: center; box-sizing: border-box; }
        
        .item-controls { display: flex; align-items: center; }

        .duplicate-btn, .delete-btn {
            background: transparent; border: none; font-size: 1.5em; color: #aaa;
            cursor: pointer; padding: 0 5px; opacity: 0.5; transition: opacity 0.3s, color 0.3s;
        }
        .character-item:hover .duplicate-btn, .character-item:hover .delete-btn { opacity: 1; }
        .duplicate-btn:hover { color: #3498db; }
        .delete-btn:hover { color: #f00; }

        #reset-btn { background-color: #e74c3c; color: white; border-color: #c0392b; }
        #capture-btn { background-color: #28a745; color: white; border-color: #218838; }

        .how-to-use { margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 4px; }
        .how-to-use summary { padding: 10px 15px; font-weight: bold; cursor: pointer; outline: none; background-color: var(--list-bg); }
        .how-to-use-content { padding: 0 15px 15px 15px; background-color: var(--item-bg); border-top: 1px solid var(--border-color); }
        .how-to-use-content h4 { margin: 15px 0 5px 0; }
        .how-to-use-content ul { padding-left: 20px; margin: 0; }
        
        /* ================================================================== */
        /* „ÉÜ„Éº„Éû„Åî„Å®„ÅÆ„Çπ„Çø„Ç§„É´                                               */
        /* ================================================================== */

        body.theme-default {
            --base-bg: #2c3e50; --text-color: #ecf0f1; --container-bg: #34495e; --header-bg: #34495e;
            --list-bg: #2c3e50; --item-bg: #4a637e; --border-color: #2c3e50; --accent-color: #3498db;
            --font-main: 'Meiryo', '„É°„Ç§„É™„Ç™', sans-serif;
        }
        .theme-default h1, .theme-default h2 { color: #95a5a6; }
        .theme-default .char-icon::before { font-size: 1em; }
        .theme-default .char-icon.investigator::before, .theme-default .char-icon.npc::before { content: 'üë§'; }
        .theme-default .char-icon.enemy::before { content: 'üíÄ'; }
        .theme-default .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #95a5a6 50%, transparent calc(50% + 1px)); }
        
        body.theme-cyber {
            --base-bg: #0d0f18; --text-color: #e0e0e0; --container-bg: rgba(20, 25, 40, 0.7); --header-bg: transparent;
            --list-bg: rgba(0, 0, 0, 0.2); --item-bg: transparent; --border-color: #00ffff; --accent-color: #00ffff;
            --font-main: 'Share Tech Mono', monospace;
        }
        .theme-cyber .container { box-shadow: 0 0 5px var(--border-color), 0 0 10px var(--border-color); backdrop-filter: blur(10px); }
        .theme-cyber h1 { color: var(--accent-color); text-shadow: 0 0 3px var(--accent-color); }
        .theme-cyber .char-initiative { text-shadow: 0 0 3px var(--accent-color); }
        .theme-cyber .char-icon { background-color: var(--dynamic-color); width: 16px; height: 16px; }
        .theme-cyber .char-icon.investigator { transform: rotate(45deg); }
        .theme-cyber .char-icon.npc { border-radius: 50%; }
        .theme-cyber .duplicate-btn:hover, .theme-cyber .delete-btn:hover { color: var(--accent-color); text-shadow: 0 0 5px var(--accent-color); }
        .theme-cyber #capture-btn { background-color: #00ffff; color: #0d0f18; border-color: #00ffff; box-shadow: 0 0 5px #00ffff; }
        .theme-cyber #reset-btn { background-color: #ff00ff; color: #0d0f18; border-color: #ff00ff; box-shadow: 0 0 5px #ff00ff; }
        .theme-cyber .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }
        .theme-cyber .how-to-use summary { color: var(--accent-color); }

        body.theme-classic {
            --base-bg: #e8e0d0; --text-color: #4a3f35; --container-bg: #fdfaf2; --header-bg: #f8f1e3;
            --list-bg: #e8e0d0; --item-bg: #fdfaf2; --border-color: #c9bba8; --accent-color: #a67b5b;
            --font-main: 'Playfair Display', serif;
        }
        .theme-classic .container { box-shadow: 5px 5px 15px rgba(0,0,0,0.2); }
        .theme-classic h1 { font-weight: 700; color: var(--text-color); }
        .theme-classic .character-item { border-radius: 0; }
        .theme-classic .char-icon { background-color: var(--dynamic-color); width: 14px; height: 14px; border: 1px solid var(--text-color); }
        .theme-classic .char-icon.investigator { border-radius: 50%; }
        .theme-classic .char-icon.npc { border-radius: 50%; width: 10px; height: 10px; }
        .theme-classic #reset-btn { background-color: #8b4513; border-color: #653412; }
        .theme-classic .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }

        body.theme-japanese {
            --base-bg: #f3f3f3; --text-color: #333333; --container-bg: #ffffff; --header-bg: #fff;
            --list-bg: #e9e5e0; --item-bg: #fff; --border-color: #dcdcdc; --accent-color: #c0392b;
            --font-main: 'Noto Serif JP', serif;
        }
        .theme-japanese .container { border: 2px solid #333; }
        .theme-japanese h1 { color: var(--accent-color); font-weight: 700; }
        .theme-japanese .character-item { border-right: 5px solid var(--dynamic-color); }
        .theme-japanese .char-icon::before { font-size: 1em; }
        .theme-japanese .char-icon.investigator::before { content: 'Êé¢'; }
        .theme-japanese .char-icon.npc::before { content: 'ÔºÆ'; }
        .theme-japanese .char-icon.enemy::before { content: 'Êïµ'; }
        .theme-japanese .duplicate-btn:hover, .theme-japanese .delete-btn:hover { color: var(--accent-color); }
        .theme-japanese #reset-btn { background-color: #8B0000; border-color: #5a0000; }
        .theme-japanese .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }
        
        body.theme-gothic {
            --base-bg: #1a1a1a; --text-color: #d8d8d8; --container-bg: #2a2a2a; --header-bg: #2a2a2a;
            --list-bg: #1f1f1f; --item-bg: #3a3a3a; --border-color: #444; --accent-color: #9a0000;
            --font-main: 'Crimson Text', serif;
        }
        .theme-gothic .container, .theme-gothic .dex-cycle { border-color: var(--accent-color); box-shadow: 0 0 8px rgba(154, 0, 0, 0.5); }
        .theme-gothic h1 { font-style: italic; color: var(--accent-color); text-shadow: 0 0 5px #ff0000; }
        .theme-gothic .char-icon { width: 16px; height: 16px; position: relative; }
        .theme-gothic .char-icon::before, .theme-gothic .char-icon::after { content: ''; position: absolute; background-color: var(--dynamic-color); }
        .theme-gothic .char-icon.investigator::before, .theme-gothic .char-icon.npc::before { width: 100%; height: 2px; top: 50%; transform: translateY(-50%); }
        .theme-gothic .char-icon.investigator::after, .theme-gothic .char-icon.npc::after { width: 2px; height: 100%; left: 50%; transform: translateX(-50%); }
        .theme-gothic .char-icon.enemy::before { width: 100%; height: 2px; top: 50%; transform: translateY(-50%) rotate(45deg); }
        .theme-gothic .char-icon.enemy::after { width: 100%; height: 2px; top: 50%; transform: translateY(-50%) rotate(-45deg); }
        .theme-gothic .duplicate-btn:hover, .theme-gothic .delete-btn:hover { color: var(--accent-color); }
        .theme-gothic #reset-btn { background-color: var(--accent-color); border-color: #660000; }
        .theme-gothic .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), var(--border-color) 50%, transparent calc(50% + 1px)); }

        body.theme-mountain {
            --base-bg: #dde4ed; --text-color: #2c3e50; --container-bg: rgba(240, 245, 255, 0.8); --header-bg: transparent;
            --list-bg: rgba(200, 210, 225, 0.5); --item-bg: rgba(255, 255, 255, 0.7); --border-color: #a0b0c0; --accent-color: #c0392b;
            --font-main: 'Special Elite', monospace;
            background-image: linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%), linear-gradient(-45deg, rgba(255,255,255,0.05) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.05) 75%), linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.05) 75%);
            background-size: 20px 20px;
            background-color: #34495e;
        }
        .theme-mountain .container { border-style: double; border-width: 3px; backdrop-filter: blur(5px); }
        .theme-mountain h1 { color: #2c3e50; letter-spacing: 2px; }
        .theme-mountain .character-item { border-radius: 2px; border-left: 4px solid var(--dynamic-color); }
        .theme-mountain .char-initiative { color: var(--accent-color); }
        .theme-mountain .char-icon { position: relative; }
        .theme-mountain .char-icon::before, .theme-mountain .char-icon::after { content: ''; position: absolute; background-color: var(--dynamic-color); }
        .theme-mountain .char-icon.investigator::before { width: 3px; height: 100%; left: 50%; transform: translateX(-50%); border-radius: 2px; }
        .theme-mountain .char-icon.investigator::after { width: 60%; height: 3px; top: 15%; left: 15%; transform-origin: left; transform: rotate(-15deg); border-radius: 2px; }
        .theme-mountain .char-icon.npc { border: 3px solid var(--dynamic-color); border-right-color: transparent; border-radius: 10px 50% 50% 10px; transform: rotate(-45deg); background-color: transparent !important; }
        .theme-mountain .char-icon.npc::before, .theme-mountain .char-icon.npc::after { display: none; }
        .theme-mountain .char-icon.enemy { background-color: transparent; border-style: solid; border-width: 0 10px 17.3px 10px; border-color: transparent transparent var(--dynamic-color) transparent; width: 0; height: 0; }
        .theme-mountain #reset-btn { background-color: var(--accent-color); border-color: #992d22; }
        .theme-mountain #capture-btn { background-color: #f39c12; color: white; border-color: #e67e22; }
        .theme-mountain .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #a0b0c0 50%, transparent calc(50% + 1px)); }

        body.theme-mono {
            --base-bg: #ffffff; --text-color: #000000; --container-bg: #ffffff; --header-bg: #ffffff;
            --list-bg: #f5f5f5; --item-bg: #ffffff; --border-color: #000000; --accent-color: #000000;
            --font-main: 'Helvetica', 'Arial', sans-serif;
        }
        .theme-mono .container { border: 2px solid #000; box-shadow: none; border-radius: 0; }
        .theme-mono .dex-cycle { border: 2px solid #000; }
        .theme-mono h1 { font-weight: bold; }
        .theme-mono button, .theme-mono select, .theme-mono input[type="text"], .theme-mono input[type="color"] { border-radius: 0; border: 1px solid #000; }
        .theme-mono button { background-color: #eee; }
        .theme-mono button:hover { background-color: #ddd; }
        .theme-mono #reset-btn, .theme-mono #capture-btn { background-color: #000; color: #fff; }
        .theme-mono .character-item { border-radius: 0; }
        .theme-mono .char-icon.investigator { border: 3px solid var(--dynamic-color); border-radius: 50%; }
        .theme-mono .char-icon.npc { background-color: var(--dynamic-color); border-radius: 50%; }
        .theme-mono .char-icon.enemy { background-color: var(--dynamic-color); }
        .theme-mono .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #ccc 50%, transparent calc(50% + 1px)); }
        
        body.theme-fbi {
            --base-bg: #1c232e; --text-color: #ecf0f1; --container-bg: #2c3e50; --header-bg: #2c3e50;
            --list-bg: #1c232e; --item-bg: #34495e; --border-color: #76ff03; --accent-color: #76ff03;
            --font-main: 'Oswald', sans-serif;
        }
        .theme-fbi .container { border: 2px solid var(--accent-color); box-shadow: 0 0 10px rgba(118, 255, 3, 0.5); }
        .theme-fbi h1 { color: var(--accent-color); text-transform: uppercase; letter-spacing: 2px; font-weight: 700; }
        .theme-fbi h2 { color: #ecf0f1; text-transform: uppercase; border-bottom: 1px solid rgba(118, 255, 3, 0.5); padding-bottom: 5px; }
        .theme-fbi .add-character-form input[type="text"], .theme-fbi .add-character-form input[type="number"], .theme-fbi .add-character-form select, .theme-fbi .add-character-form button { border: 1px solid var(--accent-color); background-color: #1c232e; color: var(--text-color); }
        .theme-fbi button { background-color: var(--accent-color); color: #1c232e; border: none; font-weight: bold; }
        .theme-fbi button:hover { opacity: 0.8; }
        .theme-fbi #reset-btn { background-color: #e74c3c; color: white; border-color: #e74c3c; }
        .theme-fbi #capture-btn { background-color: #76ff03; color: #1c232e; border-color: #76ff03; }
        .theme-fbi .character-item { border: 1px solid #4a637e; border-left: 5px solid var(--accent-color); background-color: var(--item-bg); }
        .theme-fbi .char-initiative { color: var(--accent-color); font-weight: 700; }
        .theme-fbi .char-icon.investigator { background-color: var(--dynamic-color); border-radius: 2px; width: 1.2em; height: 1.2em; }
        .theme-fbi .char-icon.npc { background-color: var(--dynamic-color); border-radius: 50%; width: 1.2em; height: 1.2em; }
        .theme-fbi .char-icon.enemy { border: 2px solid var(--dynamic-color); width: 1.2em; height: 1.2em; transform: rotate(45deg); background-color: transparent; }
        .theme-fbi .delete-btn, .theme-fbi .duplicate-btn { color: #ccc; }
        .theme-fbi .duplicate-btn:hover, .theme-fbi .delete-btn:hover { color: var(--accent-color); }
        .theme-fbi .character-list:empty::before { background-image: linear-gradient(to top left, transparent calc(50% - 1px), #4a637e 50%, transparent calc(50% + 1px)); }
        .theme-fbi .how-to-use summary { background-color: #1c232e; color: var(--accent-color); border-bottom: 1px solid var(--accent-color); }
        .theme-fbi .how-to-use-content { background-color: #2c3e50; border-top: 1px dashed var(--accent-color); }
        .theme-fbi .how-to-use-content h4 { color: var(--accent-color); }
        .theme-fbi .how-to-use-content ul li { color: #ecf0f1; }

    </style>
</head>
<body class="theme-default">
    <div class="container">
        <header>
            <h1 id="main-title">COMBAT INITIATIVE</h1>

            <details class="how-to-use">
                <summary id="how-to-use-summary">How to Use</summary>
                <div class="how-to-use-content" id="how-to-use-content"></div>
            </details>

            <div class="controls-wrapper">
                <div class="top-controls">
                    <div class="theme-switcher-wrapper">
                        <label for="theme-switcher" id="theme-label">„Çπ„Ç≠„É≥: </label>
                        <select id="theme-switcher">
                            <option value="theme-default">„Éá„Éï„Ç©„É´„Éà</option>
                            <option value="theme-fbi">FBIÔºàÊçúÊüªÁè≠Ôºâ</option>
                            <option value="theme-cyber">„Çµ„Ç§„Éê„Éº</option>
                            <option value="theme-classic">„ÇØ„É©„Ç∑„ÉÉ„ÇØ</option>
                            <option value="theme-japanese">ÂíåÈ¢®</option>
                            <option value="theme-gothic">„Ç¥„Ç∑„ÉÉ„ÇØ</option>
                            <option value="theme-mountain">ÁôªÂ±±ÔºàÁãÇÊ∞óÂ±±ËÑàÔºâ</option>
                            <option value="theme-mono">„É¢„Éé„ÇØ„É≠</option>
                        </select>
                    </div>
                    <button id="reset-btn">ÂÖ®ÂâäÈô§</button>
                    <button id="capture-btn">ÁîªÂÉèÂá∫Âäõ</button>
                </div>
                <div class="add-character-form">
                    <div class="char-type-selector">
                        <input type="radio" id="type-investigator" name="char-type" value="investigator" checked>
                        <label for="type-investigator" id="label-investigator">Êé¢Á¥¢ËÄÖ</label>
                        <input type="radio" id="type-npc" name="char-type" value="npc">
                        <label for="type-npc" id="label-npc">NPC</label>
                        <input type="radio" id="type-enemy" name="char-type" value="enemy">
                        <label for="type-enemy" id="label-enemy">„Ç®„Éç„Éü„Éº</label>
                    </div>
                    <input type="text" id="character-name" placeholder="„Ç≥„Éû„ÅÆÂêçÂâç">
                    <input type="text" id="character-initiative" placeholder="INIT">
                    <input type="color" id="character-color" value="#000000">
                    <button id="add-character-btn">ËøΩÂä†</button>
                </div>
            </div>
        </header>

        <main class="combat-rounds" id="capture-area">
            <div class="dex-cycle" id="dex-cycle-1">
                <h2 id="dex-cycle-1-title">Á¨¨1DEX„Çµ„Ç§„ÇØ„É´ (ÈäÉÁÅ´Âô®ÂÖàÊîª)</h2>
                <ul class="character-list" id="list-1"></ul>
            </div>
            <div class="dex-cycle" id="dex-cycle-2">
                <h2 id="dex-cycle-2-title">Á¨¨2DEX„Çµ„Ç§„ÇØ„É´ (ÈÄöÂ∏∏Ë°åÂãï)</h2>
                <ul class="character-list" id="list-2"></ul>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- UI„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂÆöÁæ© ---
            const uiText = {
                default: { mainTitle: "COMBAT INITIATIVE", themeLabel: "„Çπ„Ç≠„É≥: ", resetBtn: "ÂÖ®ÂâäÈô§", captureBtn: "ÁîªÂÉèÂá∫Âäõ", labelInvestigator: "Êé¢Á¥¢ËÄÖ", labelNpc: "NPC", labelEnemy: "„Ç®„Éç„Éü„Éº", addBtn: "ËøΩÂä†", namePlaceholder: "„Ç≥„Éû„ÅÆÂêçÂâç", initPlaceholder: "INIT", dex1Title: "Á¨¨1DEX„Çµ„Ç§„ÇØ„É´ (ÈäÉÁÅ´Âô®ÂÖàÊîª)", dex2Title: "Á¨¨2DEX„Çµ„Ç§„ÇØ„É´ (ÈÄöÂ∏∏Ë°åÂãï)", emptyData: "--- NO DATA ---", howToUseTitle: "How to Use", howToUseContent: `<h4>„Ç≥„Éû„ÅÆËøΩÂä†</h4><ul><li>ÂêçÂâç„ÄÅINIT(„Ç§„Éã„Ç∑„Ç¢„ÉÅ„ÉñÂÄ§)„ÄÅÁ®ÆÈ°û„ÄÅ„Ç§„É°„Éº„Ç∏„Ç´„É©„Éº„ÇíË®≠ÂÆö„Åó„Å¶„ÄåËøΩÂä†„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Åæ„Åô„ÄÇ</li><li>INIT„Å´„ÅØÊï∞Â≠ó„ÅÆ„Åª„Åã„ÄåÔºü„Äç„ÇÇÂÖ•ÂäõÂèØËÉΩ„Åß„Åô„ÄÇ</li></ul><h4>„Ç§„Éã„Ç∑„Ç¢„ÉÅ„ÉñÁÆ°ÁêÜ</h4><ul><li>„Ç≥„Éû„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó„ÅßËá™Áî±„Å´Ë°åÂãïÈ†Ü„Çí‰∏¶„ÅπÊõø„Åà„Çâ„Çå„Åæ„Åô„ÄÇ</li><li>ÈäÉÁÅ´Âô®ÂÖàÊîª„ÇíË°å„ÅÜ„Ç≥„Éû„ÅØ„ÄåÁ¨¨1DEX„Çµ„Ç§„ÇØ„É´„Äç„Å∏ÁßªÂãï„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÔºàÂü∫Êú¨„É´„Éº„É´„Éñ„ÉÉ„ÇØp65ÂèÇÁÖßÔºâ</li></ul><h4>ÁÆ°ÁêÜÊ©üËÉΩ</h4><ul><li>ÂêÑ„Ç≥„Éû„ÅÆÂè≥„ÅÆ„Äå√ó„Äç„ÅßÂÄãÂà•ÂâäÈô§„ÄÅ„ÄåÂÖ®ÂâäÈô§„Äç„ÅßÂÖ®Âì°„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ</li><li>„Äå‚ùê„Äç„Éú„Çø„É≥„Åß„Ç≥„Éû„ÇíË§áË£Ω„Åß„Åç„Åæ„Åô„ÄÇ</li><li>„ÄåÁîªÂÉèÂá∫Âäõ„Äç„ÅßÊà¶Èóò„É©„Ç¶„É≥„ÉâÈÉ®ÂàÜ„ÇíPNGÁîªÂÉè„Å®„Åó„Å¶‰øùÂ≠ò„Åß„Åç„Åæ„Åô„ÄÇ</li></ul>` },
                japanese: { mainTitle: "Êà¶ÈóòÂ∫èÂàó", themeLabel: "ÊÑèÂå†: ", resetBtn: "ÂÖ®Ê∂àÂéª", captureBtn: "ÁµµÂõ≥Âá∫Âäõ", labelInvestigator: "Êé¢Á¥¢ËÄÖ", labelNpc: "NPC", labelEnemy: "ÊïµÂØæËÄÖ", addBtn: "ËøΩÂä†", namePlaceholder: "„Ç≥„Éû„ÅÆÂêçÂâç", initPlaceholder: "Ë°åÂãïÂÄ§", dex1Title: "Â£±‰πãÂ∑°ÔºàÈäÉÁÅ´Âô®ÂÖàÊîªÔºâ", dex2Title: "Âºê‰πãÂ∑°ÔºàÈÄöÂ∏∏Ë°åÂãïÔºâ", emptyData: "Ë©≤ÂΩìËÄÖ„Å™„Åó", howToUseTitle: "‰ΩøÁî®ÊñπÊ≥ï", howToUseContent: `<h4>„Ç≥„Éû„ÅÆËøΩÂä†</h4><ul><li>ÂêçÂâç„ÄÅË°åÂãïÂÄ§„ÄÅÁ®ÆÂà•„ÄÅÈÖçËâ≤„ÇíÊåáÂÆö„Åó„ÄåËøΩÂä†„Äç„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</li><li>Ë°åÂãïÂÄ§„Å´„ÅØÊï∞Â≠ó„ÅÆ„Åª„Åã„ÄåÔºü„Äç„ÇÇÂÖ•ÂäõÂèØËÉΩ„Åß„Åô„ÄÇ</li></ul><h4>Ë°åÂãïÈ†Ü„ÅÆÁÆ°ÁêÜ</h4><ul><li>ÂêÑ„Ç≥„Éû„ÅØ„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó„ÅßËá™Áî±„Å´Ë°åÂãïÈ†Ü„Çí‰∏¶„ÅπÊõø„Åà„Çâ„Çå„Åæ„Åô„ÄÇ</li><li>ÈäÉÁÅ´Âô®ÂÖàÊîª„ÇíË°å„ÅÜ„Ç≥„Éû„ÅØ„ÄåÂ£±‰πãÂ∑°„Äç„Å∏ÁßªÂãï„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÔºàÂü∫Êú¨„É´„Éº„É´„Éñ„ÉÉ„ÇØp65ÂèÇÁÖßÔºâ</li></ul><h4>ÁÆ°ÁêÜÊ©üËÉΩ</h4><ul><li>ÂêÑ„Ç≥„Éû„ÅÆÂè≥„ÅÆ„Äå√ó„Äç„ÅßÂÄãÂà•Ê∂àÂéª„ÄÅ„ÄåÂÖ®Ê∂àÂéª„Äç„ÅßÂÖ®Âì°„ÇíÊ∂àÂéª„Åó„Åæ„Åô„ÄÇ</li><li>„Äå‚ùê„Äç„Éú„Çø„É≥„Åß„Ç≥„Éû„ÇíË§áË£Ω„Åß„Åç„Åæ„Åô„ÄÇ</li><li>„ÄåÁµµÂõ≥Âá∫Âäõ„Äç„ÅßÊà¶ÈóòÂ∫èÂàó„ÅÆÈÉ®ÂàÜ„ÇíPNGÁîªÂÉè„Å®„Åó„Å¶‰øùÂ≠ò„Åß„Åç„Åæ„Åô„ÄÇ</li></ul>` },
                fbi: { mainTitle: "FBI TACTICAL ORDER", themeLabel: "THEME: ", resetBtn: "CLEAR ALL", captureBtn: "EXPORT IMAGE", labelInvestigator: "AGENT", labelNpc: "CIVILIAN", labelEnemy: "HOSTILE", addBtn: "ADD", namePlaceholder: "NAME", initPlaceholder: "INIT", dex1Title: "CYCLE 1 (FIREARMS PRIORITY)", dex2Title: "CYCLE 2 (STANDARD ACTIONS)", emptyData: "--- NO ENTRIES ---", howToUseTitle: "OPERATIONAL GUIDANCE", howToUseContent: `<h4>ADD ENTRY</h4><ul><li>Enter name, INIT (Initiative value), type, and select a color, then click "ADD".</li><li>INIT field accepts numbers or "?".</li></ul><h4>MANAGE INITIATIVE</h4><ul><li>Entries can be reordered by drag & drop.</li><li>Move firearm-wielding characters to "CYCLE 1". (Refer to the basic rulebook, p. 65)</li></ul><h4>CONTROL FUNCTIONS</h4><ul><li>Click "√ó" to delete individual entries, or "CLEAR ALL" to remove all.</li><li>Click "‚ùê" to duplicate an entry.</li><li>"EXPORT IMAGE" saves the tactical order section as a PNG image.</li></ul>` }
            };
            
            // --- Ë¶ÅÁ¥†ÂèñÂæó ---
            const nameInput = document.getElementById('character-name');
            const initiativeInput = document.getElementById('character-initiative');
            const colorInput = document.getElementById('character-color');
            const addButton = document.getElementById('add-character-btn');
            const lists = document.querySelectorAll('.character-list');
            const themeSwitcher = document.getElementById('theme-switcher');
            const resetButton = document.getElementById('reset-btn');
            const captureButton = document.getElementById('capture-btn');
            const captureArea = document.getElementById('capture-area');

            let draggedItem = null;

            // --- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö ---
            addButton.addEventListener('click', () => addCharacterFromForm());
            nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCharacterFromForm(); });
            initiativeInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addCharacterFromForm(); });
            
            themeSwitcher.addEventListener('change', (e) => {
                const theme = e.target.value;
                document.body.className = theme;
                updateUiText(theme);
                document.querySelectorAll('.character-item').forEach(updateInitiativeDisplay);
            });
            
            resetButton.addEventListener('click', resetAll);
            captureButton.addEventListener('click', captureAndDownload);

            lists.forEach(list => {
                list.addEventListener('click', (e) => {
                    const targetItem = e.target.closest('.character-item');
                    if (!targetItem) return;

                    if (e.target.closest('.delete-btn')) {
                        targetItem.remove();
                    } else if (e.target.closest('.duplicate-btn')) {
                        duplicateCharacter(targetItem);
                    }
                });
            });
            
            // --- Èñ¢Êï∞ÂÆöÁæ© ---
            function createCharacterElement(name, initiative, color, charType) {
                const li = document.createElement('li');
                li.className = 'character-item';
                li.draggable = true;
                li.dataset.initiative = initiative;
                
                li.innerHTML = `
                    <div class="character-info">
                        <span class="char-initiative"></span>
                        <span class="char-icon ${charType}"></span>
                        <span class="char-name">${name}</span>
                    </div>
                    <div class="item-controls">
                        <button class="duplicate-btn">‚ùê</button>
                        <button class="delete-btn">√ó</button>
                    </div>
                `;
                
                li.style.setProperty('--dynamic-color', color);
                li.querySelector('.char-name').style.color = color;
                
                updateInitiativeDisplay(li);
                addDragEvents(li);
                return li;
            }
            
            function addCharacterFromForm() {
                const name = nameInput.value.trim();
                let initiative = initiativeInput.value.trim();
                const color = colorInput.value;
                const charType = document.querySelector('input[name="char-type"]:checked').value;

                if (name === '') { alert('„Ç≥„Éû„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }
                
                initiative = initiative.replace(/[Ôºê-Ôºô]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));

                const newCharElement = createCharacterElement(name, initiative, color, charType);
                document.getElementById('list-2').appendChild(newCharElement);

                nameInput.value = '';
                initiativeInput.value = '';
                nameInput.focus();
            }

            function duplicateCharacter(originalItem) {
                const name = originalItem.querySelector('.char-name').textContent;
                const initiative = originalItem.dataset.initiative;
                const color = originalItem.style.getPropertyValue('--dynamic-color');
                const iconSpan = originalItem.querySelector('.char-icon');
                const charType = Array.from(iconSpan.classList).find(c => c !== 'char-icon');

                const newCharElement = createCharacterElement(name, initiative, color, charType);
                originalItem.after(newCharElement);
            }

            function updateUiText(theme) {
                const themeKey = theme.replace('theme-', '');
                const textSet = uiText[themeKey] || uiText.default;

                document.getElementById('main-title').textContent = textSet.mainTitle;
                document.getElementById('theme-label').textContent = textSet.themeLabel;
                resetButton.textContent = textSet.resetBtn;
                captureButton.textContent = textSet.captureBtn;
                document.getElementById('label-investigator').textContent = textSet.labelInvestigator;
                document.getElementById('label-npc').textContent = textSet.labelNpc;
                document.getElementById('label-enemy').textContent = textSet.labelEnemy;
                addButton.textContent = textSet.addBtn;
                nameInput.placeholder = textSet.namePlaceholder;
                initiativeInput.placeholder = textSet.initPlaceholder;
                document.getElementById('dex-cycle-1-title').textContent = textSet.dex1Title;
                document.getElementById('dex-cycle-2-title').textContent = textSet.dex2Title;
                document.getElementById('how-to-use-summary').textContent = textSet.howToUseTitle;
                document.getElementById('how-to-use-content').innerHTML = textSet.howToUseContent;
                lists.forEach(list => list.dataset.emptyText = textSet.emptyData);
            }
            
            function updateInitiativeDisplay(listItem) {
                const initiativeValue = listItem.dataset.initiative;
                const displaySpan = listItem.querySelector('.char-initiative');

                if (document.body.classList.contains('theme-japanese')) {
                    displaySpan.textContent = toKanjiNumber(initiativeValue);
                } else {
                    displaySpan.textContent = initiativeValue || '-';
                }
            }
            
            function toKanjiNumber(numStr) {
                if (!numStr || isNaN(parseInt(numStr, 10))) { return numStr || '-'; }
                const num = parseInt(numStr, 10);
                if (num === 0) return 'Èõ∂';
                const kanjiDigits = ['', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', '‰∏É', 'ÂÖ´', '‰πù'];
                let result = '';
                if (num >= 10) {
                    const tens = Math.floor(num / 10);
                    result += (tens > 1 ? kanjiDigits[tens] : '') + 'ÂçÅ';
                }
                const ones = num % 10;
                if (ones > 0) { result += kanjiDigits[ones]; }
                return result;
            }

            function resetAll() {
                if (confirm('Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Ç≥„Éû„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                    lists.forEach(list => list.innerHTML = '');
                }
            }
            
            function captureAndDownload() {
                const computedStyle = getComputedStyle(document.body);
                let bgColor = computedStyle.backgroundColor;
                if (bgColor === 'rgba(0, 0, 0, 0)') { bgColor = '#ffffff'; }

                html2canvas(captureArea, {
                    backgroundColor: bgColor, scale: 2,
                    windowWidth: captureArea.scrollWidth, windowHeight: captureArea.scrollHeight
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'combat_initiative.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }

            function addDragEvents(item) {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    setTimeout(() => item.classList.add('dragging'), 0);
                });
                item.addEventListener('dragend', () => {
                    if(draggedItem) draggedItem.classList.remove('dragging');
                    draggedItem = null;
                });
            }

            lists.forEach(list => {
                list.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(list, e.clientY);
                    if (draggedItem) {
                        if (afterElement == null) list.appendChild(draggedItem);
                        else list.insertBefore(draggedItem, afterElement);
                    }
                });
            });

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.character-item:not(.dragging)')];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            
            updateUiText(themeSwitcher.value);
        });
    </script>
</body>
</html>
